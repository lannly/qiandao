<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>签到</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="format-detection" content="telphone=no, email=no"/>
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">
    <meta name="wap-font-scale" content="no">
    <link rel="stylesheet" href="css/reset.css"/>
    <link rel="stylesheet" href="css/index.css"/>
    <style>

    </style>
</head>
<div class="gifts">
    <div class="giftHd">
        <div class="giftItem">
            <div class="giftImg"><img src="img/day_1.png" alt=""></div>
            首次签到
        </div>
        <div class="giftItem">
            <div class="giftImg"><img src="img/day7.png" alt=""></div>
            耳机礼包
        </div>
        <div class="giftItem">
            <div class="giftImg"><img src="img/day14.png" alt=""></div>
            平板礼包
        </div>
        <div class="giftItem">
            <div class="giftImg"><img src="img/day21.png" alt=""></div>
            手机礼包
        </div>
        <div class="giftItem">
            <div class="giftImg"><img src="img/day_last.png" alt=""></div>
            电脑礼包
        </div>
    </div>
    <div class="giftBd">
        <div class="giftItem">
            <div class="giftState"></div>
            1天
        </div>
        <div class="giftItem">
            <div class="giftState"></div>
            7天
        </div>
        <div class="giftItem">
            <div class="giftState"></div>
            14天
        </div>
        <div class="giftItem">
            <div class="giftState"></div>
            21天
        </div>
        <div class="giftItem">
            <div class="giftState"></div>
            <span id="curMonthDays">30</span>天
        </div>
    </div>
</div>
<div class="signHd">
    <div class="txt">
        <div class="todayDate">2017年2月13号</div>
        <div class="totalSign">本月累计签到 <span id="totalTimes"></span>次</div>
    </div>
    <input type="button" id="signBtn" value="点击签到"/>
</div>
<div id="CalendarMain">
    <div id="context">
        <div class="week">
            <h3> 日 </h3>
            <h3> 一 </h3>
            <h3> 二 </h3>
            <h3> 三 </h3>
            <h3> 四 </h3>
            <h3> 五 </h3>
            <h3> 六 </h3>

        </div>
        <div id="center">
            <div id="centerMain">
                <div id="centerCalendarMain">
                    <div id="Container"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="rule">
    <div class="tt">活动规则</div>
    <ul class="txt">
        <li>1.选2礼品为：酒后代驾、健康礼包+多功能逃生锤、云南白药、灭火器。</li>
        <li>1.选2礼品为：酒后代驾、健康礼包+多功能逃生锤、云南白药、灭火器。</li>
        <li>1.选2礼品为：酒后代驾、健康礼包+多功能逃生锤、云南白药、灭火器。</li>
    </ul>
</div>
<br><br>
<div class="popBg" id="popBg"></div>
<div class="popCon" id="popCon">
    <div class="luckPlate">
        <div class="turnPlate">
            <div class="pics" style="display:none;">
                <img src="img/8pics/redPack10.png" id="redPack10"/>
                <img src="img/8pics/ear.png" id="ear"/>
                <img src="img/8pics/redPack20.png" id="redPack20"/>
                <img src="img/8pics/pad.png" id="pad"/>
                <img src="img/8pics/redPack30.png" id="redPack30"/>
                <img src="img/8pics/phone.png" id="phone"/>
                <img src="img/8pics/redPack50.png" id="redPack50"/>
                <img src="img/8pics/mac.png" id="mac"/>
                <img src="img/2.png" id="sorry-img"/>
            </div>
            <canvas class="canvasItem" id="wheelcanvas" width="422px" height="422px"></canvas>
            <button class="pointer bTn"></button>
        </div>
    </div>
</div>
<div class="popHongBao" id="popHongBao">
    <div class="tt">恭喜你获得</div>
    <div class="HbMoney" id="HbMoney"><span>5</span></div>
    <div id="HbInfo">满20减5限实物商品使用</div>
    <div class="tip">已经发生到你的红包账户</div>
    <a href="javascript:void(0)" id="iKnownBtn">我知道了</a>
</div>
<div class="retroactive" id="retroactive">
    <div class="tt">补签</div>
    <div class="txt">补签一次消耗2个夺宝币</div>
    <div class="bqBtn">
        <a href="javascript:void(0)" id="okBtn">确定</a>
        <a href="javascript:void(0)" id="cancleBtn">取消</a>
    </div>
    <a href='javascript:void(0)' id='closeBtn'>确定</a>
</div>
<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
<script src="js/awardRotate.js"></script>
<script type="text/javascript">
    window.onresize = function () {
        CalendarHandler.initialize();
    };

    var remain=25; //用户当前拥有夺宝币数目 （测试假设为15） 每次补签消耗2个夺宝币，夺宝币不够2个不能补签
    var loginStatus =1; //用户登录状态 0,未登录，1，已登录
    var todaySignStatus =1; //今天是否已签到 0,未签到，1，已签到
    var signCount = 3; //当月累计签到天数
    var hongbaoInfo; //红包信息
    var giftInfo; //礼包信息
    var status=1; //0：不具备红包权限(判断是否弹出抽奖转盘) 1:有红包

    document.body.addEventListener('touchstart', function () {//解决iOS下a的actived点击
    });
    $(document).ready(function () {
        CalendarHandler.initialize();
        giftChange();
        if(loginStatus ==1 && todaySignStatus == 1 ){  //用户已经登录且已经签到 弹出小红包

            if(status==0){ // 0：不具备红包权限 即此时没有小红包
                if(signCount==1 ||signCount==7||signCount==14||signCount==21){
                    showLuckPlate(); //弹出抽奖转盘
                }else if(signCount==parseInt(document.getElementById("curMonthDays").innerHTML)){
                    showLuckPlate(); //弹出抽奖转盘
                }

            }else{  // 1：不具备红包权限 即此时有小红包
                showHongBao(10); //弹出20元 红包 测试数据可为 5 10 20
            }

        }
        function giftChange(){
            if(signCount>=1 && signCount<7){
                $(".gifts .giftHd .giftItem:lt(1)").addClass("finished");
                $(".gifts .giftBd .giftItem:lt(1)").addClass("finished");
            }else if(signCount>=7 && signCount<14){
                $(".gifts .giftHd .giftItem:lt(2)").addClass("finished");
                $(".gifts .giftBd .giftItem:lt(2)").addClass("finished");
            }else if(signCount>=14 && signCount<21){
                $(".gifts .giftHd .giftItem:lt(3)").addClass("finished");
                $(".gifts .giftBd .giftItem:lt(3)").addClass("finished");
            }else if( signCount>=21 && signCount<28){
                $(".gifts .giftHd .giftItem:lt(4)").addClass("finished");
                $(".gifts .giftBd .giftItem:lt(4)").addClass("finished");
            }else if(signCount==parseInt(document.getElementById("curMonthDays").innerHTML)){
                $(".gifts .giftHd .giftItem:lt(5)").addClass("finished");
                $(".gifts .giftBd .giftItem:lt(5)").addClass("finished");
            }
        }


        //获取当天日期
        var thisDate = new Date();
        var thisYear = thisDate.getFullYear();
        var thisMonth =  thisDate.getMonth() + 1;
        var thisDay =  thisDate.getDate();
        $(".todayDate").html(thisYear + "年"+thisMonth + "月"+thisDay + "月"); //当天日期

        $(".item.thisMonthItem a").each(function(){  //本月在当日之前的显示可补签
            var bq=$(this).text();
            if(parseInt(bq)<thisDay){ //可补签天数< 当前日期
                $(this).parent().addClass("bq");
                var signMonthInfo =[0,1,0,0,0,0,1,1,0,null,null,null,null]; //当月签到信息 0 未签到 1 已签到
                for(var i=0;i<signMonthInfo.length;i++){
                    if(signMonthInfo[i] == 1){
                        $(".item.thisMonthItem").eq(i).removeClass("bq").addClass("signed"); //页面加载时候根据后台数据判断哪些已经签到
                    }
                }
            }
        });




        var HbMoney = document.getElementById("HbMoney"); //红包金额
        var HbInfo = document.getElementById("HbInfo"); //红包描述
        var totalTimes = document.getElementById("totalTimes"); //累计签到次数
        totalTimes.innerText = signCount;
        var signBtn = document.getElementById("signBtn");
        signBtn.onclick = function () {  //签到按钮点击
            $(".currentItem").addClass("signed");  //签到成功后 当日被标记为已签到
            this.setAttribute("disabled", true);  //签到按钮不可用
            this.value = "已签到"; //签到按钮 文字改变
            remain=remain+1;  //签到成功获得一个夺宝币

        };

        $(".item.thisMonthItem.bq a").click(function(){  //补签
            if(remain>=2){
                $(this).parent().addClass("signed").removeClass("bq");
                showRetroactive();
                signCount =signCount+1;  //签到天数+1
                totalTimes.innerText = signCount; //签到天数改变
            }else{
                console.log(remain); //打印剩余夺宝币个数
                showRetroactive();
                $(".retroactive .txt").html("补签一次消耗2个夺宝币</br>抱歉，夺宝币不足");
                $(".retroactive .bqBtn").hide();
                closeBtn.style.display="block";
            };
            if(signCount==1 ||signCount==7||signCount==14||signCount==21){
                closeHongBao();
                showLuckPlate(); //弹出抽奖转盘
            }else if(signCount==parseInt(document.getElementById("curMonthDays").innerHTML)){
                showLuckPlate(); //弹出抽奖转盘
            }

        });
        $(".item.thisMonthItem.currentItem a").click(function(){ //当日签到
            $(this).parent().addClass("signed");
            signBtn.setAttribute("disabled", true);
            signBtn.value = "已签到";
            remain=remain+1; //签到成功 夺宝币+1 （测试）
            console.log(remain); //打印剩余夺宝币个数
        });


    });

    var iKnownBtn =document.getElementById("iKnownBtn"); //黑色半透明遮罩
    var popBg =document.getElementById("popBg"); //黑色半透明遮罩
    var popCon =document.getElementById("popCon"); //转盘弹出层
    var popHongBao =document.getElementById("popHongBao"); //红包弹出层
    var retroactive = document.getElementById("retroactive"); //补签弹出框
    var okBtn = document.getElementById("okBtn"); //补签确认按钮
    var cancleBtn = document.getElementById("cancleBtn"); //补签取消按钮
    iKnownBtn.onclick = function(){ //点击红包中 “我知道了” 关闭红包弹出层
        closeHongBao();
    };

    function showLuckPlate() {  //弹出抽奖框
        popBg.classList.add("on");
        popCon.classList.add("on");
    }

    function showHongBao(inx) {  //显示红包弹出框
        HbMoney.innerHTML ="<span>"+inx+"</span>"+"元";
        switch (inx) {
            case 5:
                HbInfo.innerHTML ="满20减5限实物商品使用";
                break;
            case 10:
                HbInfo.innerHTML ="满50减10限实物商品使用";
                break;
            case 20:
                HbInfo.innerHTML ="满100减20,限实物商品使用";
                break;
            default:
                false;
        }
        popBg.classList.add("on");
        popHongBao .classList.add("on");
    }
    function closeHongBao(){   //显示红包弹出框
        popBg.classList.remove("on");
        popHongBao.classList.remove("on");
        popCon.classList.remove("on");
    }

    function showRetroactive(){ //显示补签提示框
        popBg.classList.add("on");
        $("#retroactive").show();
        setTimeout(function(){
            retroactive.classList.add("show");
        },70)
    }
    function hideRetroactive(){
        popBg.classList.remove("on");
        retroactive.classList.remove("show");

        setTimeout(function(){
            $("#retroactive").hide();
        },70)
    }
    okBtn.onclick=function(){
        remain=remain-2;
        console.log(remain); //打印剩余夺宝币个数
        hideRetroactive();
    };
    closeBtn.onclick=cancleBtn.onclick=function(){
        hideRetroactive();
    };


    var CalendarHandler = {
        currentYear: 0,
        currentMonth: 0,
        isRunning: false,
        tag: 0,
        initialize: function () {
            var $calendarItem = this.CreateCalendar(0, 0, 0);
            $("#Container").append($calendarItem);

            $("#context").css("height", $("#CalendarMain").height() - 65 + "px");
            $("#center").css("height", $("#context").height() - 40 + "px");
            $("#centerCalendarMain").css("height", $("#context").height() - 40 + "px").css("width", $("#context").width() + "px");

            $calendarItem.css("height", $("#context").height() - 40 + "px"); //.css("visibility","hidden");
            $("#Container").css("height", "0px").css("width", "0px").css("margin-left", $("#context").width() / 2 + "px").css("margin-top", ($("#context").height() - 40) / 2 + "px");
            $("#Container").animate({
                width: $("#context").width() + "px",
                height: ($("#context").height() - 40) * 2 + "px",
                marginLeft: "0px",
                marginTop: "0px"
            }, 30, function () {
                $calendarItem.css("visibility", "visible");
            });
            $(".dayItem").css("width", $("#context").width() + "px");
            var itemPaddintTop = $(".dayItem").height() / 6;
            $(".item").css({
                "width": $(".week").width() / 7 + "px",
                "line-height": itemPaddintTop + "px",
                "height": itemPaddintTop + "px"
            });
            $(".week>h3").css("width", $(".week").width() / 7 + "px");


        },

        IsRuiYear: function (aDate) {
            return (0 == aDate % 4 && (aDate % 100 != 0 || aDate % 400 == 0));
        },
        CalculateWeek: function (y, m, d) {
            var arr = "1234567".split("");
            with (document.all) {
                var vYear = parseInt(y, 10);
                var vMonth = parseInt(m, 10);
                var vDay = parseInt(d, 10);
            }
            var week = arr[new Date(y, m - 1, vDay).getDay()];
            return week;
        },
        CalculateMonthDays: function (m, y) {
            var mDay = 0;
            if (m == 0 || m == 1 || m == 3 || m == 5 || m == 7 || m == 8 || m == 10 || m == 12) {
                mDay = 31;
            } else {
                if (m == 2) {
                    //判断是否为润年
                    var isRn = this.IsRuiYear(y);
                    if (isRn == true) {
                        mDay = 29;
                    } else {
                        mDay = 28;
                    }
                } else {
                    mDay = 30;
                }
            }
            return mDay;
        },
        CreateCalendar: function (y, m, d) {
            var $dayItem = $("<div class=\"dayItem\"></div>");
            //获取当前月份的天数
            var nowDate = new Date();
            if (y == nowDate.getFullYear() && m == nowDate.getMonth() + 1 || (y == 0 && m == 0))
                var nowYear = y == 0 ? nowDate.getFullYear() : y;
            this.currentYear = nowYear;
            var nowMonth = m == 0 ? nowDate.getMonth() + 1 : m;
            this.currentMonth = nowMonth;
            var nowDay = d == 0 ? nowDate.getDate() : d;
//            $(".todayDate").html(nowYear + "年"+nowMonth + "月"+nowDay + "月"); //当天日期

            var nowDaysNub = this.CalculateMonthDays(nowMonth, nowYear);
            //获取当月第一天是星期几
//            var weekDate = new Date(nowYear+"-"+nowMonth+"-"+1);
//            alert(weekDate.getDay());
            var nowWeek = parseInt(this.CalculateWeek(nowYear, nowMonth, 1));
            //nowWeek=weekDate.getDay()==0?7:weekDate.getDay();
            //var nowWeek=weekDate.getDay();
            //获取本月的天数
            var curMonthDaysNub = this.CalculateMonthDays(nowMonth, nowYear);
            document.getElementById("curMonthDays").innerHTML=curMonthDaysNub;
            //获取上个月的天数
            var lastMonthDaysNub = this.CalculateMonthDays((nowMonth - 1), nowYear);



            if (nowWeek != 0) {
                //生成上月剩下的日期
                for (var i = (lastMonthDaysNub - (nowWeek - 1)); i < lastMonthDaysNub; i++) {
                    $dayItem.append("<div class=\"item lastItem\"><a>" + (i + 1) + "</a></div>");
                }
            }

            //生成当月的日期
            for (var i = 0; i < nowDaysNub; i++) {
                if (i == (nowDay - 1)) $dayItem.append("<div class=\"item thisMonthItem currentItem\"><a>" + (i + 1) + "</a></div>");
                else $dayItem.append("<div class=\"item thisMonthItem\"><a>" + (i + 1) + "</a></div>");
            }

            //获取总共已经生成的天数
            var hasCreateDaysNub = nowWeek + nowDaysNub;
            //如果小于42，往下个月推算
            if (hasCreateDaysNub < 42) {
                for (var i = 0; i <= (42 - hasCreateDaysNub); i++) {
                    $dayItem.append("<div class=\"item lastItem\"><a>" + (i + 1) + "</a></div>");
                }
            }

            return $dayItem;
        },
        CSS: function () {
            var itemPaddintTop = $(".dayItem").height() / 6;
            $(".item").css({
                "width": $(".week").width() / 7 + "px",
                "line-height": itemPaddintTop + "px",
                "height": itemPaddintTop + "px"
            });
            $(".currentItem>a").css("margin-left", ($(".item").width() - 25) / 2 + "px").css("margin-top", ($(".item").height() - 25) / 2 + "px");
        },
        CreateCurrentCalendar: function () {
            if (this.isRunning == false) {
                $(".currentDay").hide();
                $calendarItem = this.CreateCalendar(0, 0, 0);
                $("#Container").append($calendarItem);
                this.isRunning = true;
                $($("#Container").find(".dayItem")[0]).animate({
                    height: "0px"
                }, 300, function () {
                    $(this).remove();
                    CalendarHandler.isRunning = false;
                });
                this.CSS();
                $("#centerMain").animate({
                    marginLeft: -$("#center").width() + "px"
                }, 500);
            }
        }
    }
</script>
<script type="text/javascript">
    var turnplate = {
        restaraunts: [],		//大转盘奖品名称
        colors: [],				//大转盘奖品区块对应背景颜色
        outsideRadius: 162,			//大转盘外圆的半径
        textRadius: 85,		//大转盘奖品位置距离圆心的距离
        insideRadius: 38,			//大转盘内圆的半径
        startAngle: 0,			//开始角度
        bRotate: false		//false:停止;ture:旋转
    };

    $(document).ready(function () {
        //动态添加大转盘的奖品与奖品区域背景颜色
        turnplate.restaraunts = ["10元红包", "耳机", "20元红包", "Pad", "30元红包", "iPhone", "50元红包", "Mac"];
        turnplate.keyword = ["10元红包（满50减10）", "恭喜你获得耳机", "20元红包（满100减20）", "恭喜你获得pad", "30元红包（满150减30）", "恭喜你获得iphone", "50元红包（满300减50）", "恭喜你获得mac"];
        turnplate.colors = ["#c75ffe", "#9438de", "#60bacf", "#5660e2", "#fd3286", "#fb5a44","#9438de","#fd3286"];

        $('.pointer').click(function () {//点击开始，1是笔记本电脑，顺时针=============================
//            if(turnplate.bRotate)return;
//            turnplate.bRotate = !turnplate.bRotate;
            startRotate(4);
        });

        // $(".pointer").eq(0).attr({"disabled": "disabled"}); //禁用按钮的方法=========================
        $(".pointer").eq(0).removeAttr("disabled");//将按钮可用=======================================

        var rotateTimeOut = function () {
            $('#wheelcanvas').rotate({
                angle: 0,
                animateTo: 2160,
                duration: 8000,
                callback: function () {
//                    showResult(3, "网络超时，请检查您的网络设置！");
                    alert("网络超时，请检查您的网络设置！");
                }
            });
        };

        //旋转转盘 canvasItem:奖品位置; txt：提示语;
        var rotateFn = function (canvasItem) {
            var angles = canvasItem * (360 / turnplate.restaraunts.length) - (360 / (turnplate.restaraunts.length * 2));
            if (angles < 270) {
                angles = 270 - angles;
            } else {
                angles = 360 - angles + 270;
            }
            $('#wheelcanvas').stopRotate();
            $('#wheelcanvas').rotate({
                angle: 0,
                animateTo: angles + 1800,
                duration: 8000,
                callback: function () {
                    showResult(4);
                    turnplate.bRotate = !turnplate.bRotate;
                }
            });
        };

        function showResult(inx) {  //抽奖结果弹出框
            HbMoney.innerHTML ="<strong>"+turnplate.restaraunts[inx - 1]+"</strong>";
            HbInfo.innerHTML =turnplate.keyword[inx - 1];

            popBg.classList.add("on");
            popHongBao .classList.add("on");
        }
        function startRotate(index) {//开始旋转
            if (turnplate.bRotate) return;
            turnplate.bRotate = !turnplate.bRotate;
            rotateFn(index, turnplate.keyword[index - 1]);
        }

        //页面所有元素加载完毕后执行drawRouletteWheel()方法对转盘进行渲染
        window.onload = function () {
            drawRouletteWheel();
            setPopBg();
        };
        function setPopBg() {
            var totleH = document.body.scrollHeight;
            var popbg = document.querySelector(".popBg");
            var pop = document.querySelector(".popCon ");
            document.querySelector("body").style.height = totleH + "px";
            popbg.style.height = totleH + "px";
        };
        function drawRouletteWheel() {//渲染画布
            var canvas = document.getElementById("wheelcanvas");
            if (canvas.getContext) {
                //根据奖品个数计算圆周角度
                var arc = Math.PI / (turnplate.restaraunts.length / 2);
                var ctx = canvas.getContext("2d");
                //在给定矩形内清空一个矩形
                ctx.clearRect(0, 0, 422, 422);
                //strokeStyle 属性设置或返回用于笔触的颜色、渐变或模式
                ctx.strokeStyle = "#67049c";
                //font 属性设置或返回画布上文本内容的当前字体属性
                ctx.font = '16px Microsoft YaHei';
                for (var i = 0; i < turnplate.restaraunts.length; i++) {
                    var angle = turnplate.startAngle + i * arc;
                    ctx.fillStyle = turnplate.colors[i];
                    ctx.beginPath();
                    //arc(x,y,r,起始角,结束角,绘制方向) 方法创建弧/曲线（用于创建圆或部分圆）
                    ctx.arc(211, 211, turnplate.outsideRadius, angle, angle + arc, false);
                    ctx.arc(211, 211, turnplate.insideRadius, angle + arc, angle, true);
                    ctx.stroke();
                    ctx.fill();
                    //锁画布(为了保存之前的画布状态)
                    ctx.save();

                    //----绘制奖品开始----
                    ctx.fillStyle = "#fff";  //奖品对应文字
                    var text = turnplate.restaraunts[i];
                    var line_height = 20;
                    //translate方法重新映射画布上的 (0,0) 位置
                    ctx.translate(211 + Math.cos(angle + arc / 2) * turnplate.textRadius, 211 + Math.sin(angle + arc / 2) * turnplate.textRadius);

                    //rotate方法旋转当前的绘图
                    ctx.rotate(angle + arc / 2 + Math.PI / 2);

                    //添加对应图标
                    if (i == 0) {   //对应第一个 10元红包
                        var img = document.getElementById("redPack10");
                        img.onload = function () {
                            ctx.drawImage(img, -30, -60, 57, 33);
                        };
                        ctx.drawImage(img, -30, -60, 57, 33);
                    }
                    else if (i == 1) { //耳机
                        ctx.font = 'bold 20px Microsoft YaHei';
                        var img= document.getElementById("ear");
                        img.onload=function(){
                            ctx.drawImage(img,-15,-70,30,30);
                        };
                        ctx.drawImage(img,-25,-70,50,50);
                    } else if (i == 2) {  //20元红包
                        var img = document.getElementById("redPack20");
                        img.onload = function () {
                            ctx.drawImage(img, -25, -60, 64, 40);
                        };
                        ctx.drawImage(img, -25, -60, 64, 40);
                    } else if (i == 3) { //pad
                        ctx.font = 'bold 20px Microsoft YaHei';
                        var img = document.getElementById("pad");
                        img.onload = function () {
                            ctx.drawImage(img, -45, -65, 80, 45);
                        };
                        ctx.drawImage(img, -45, -65, 80, 45);
                    } else if (i == 4) { //30yuan红包
                        var img = document.getElementById("redPack30");
                        img.onload = function () {
                            ctx.drawImage(img, -40, -70, 70, 50);
                        };
                        ctx.drawImage(img, -40, -70, 70, 50);
                    } else if (i == 5) { //phone
                        ctx.font = 'bold 16px Microsoft YaHei';
                        var img = document.getElementById("phone");
                        img.onload = function () {
                            ctx.drawImage(img, -30, -70, 55, 50);
                        };
                        ctx.drawImage(img, -30, -70, 55, 50);
                    } else if (i == 6) { //50元红包
                        var img = document.getElementById("redPack50");
                        img.onload = function () {
                            ctx.drawImage(img, -40, -70, 70, 50);
                        };
                        ctx.drawImage(img, -40, -70, 70, 50);
                    } else if (i == 7) { //mac
                        ctx.font = 'bold 20px Microsoft YaHei';
                        var img = document.getElementById("mac");
                        img.onload = function () {
                            ctx.drawImage(img, -35, -70, 75, 50);
                        };
                        ctx.drawImage(img, -35, -70, 75, 50);
                    }
                    /** 下面代码根据奖品类型、奖品名称长度渲染不同效果，如字体、颜色、图片效果。(具体根据实际情况改变) **/
                    if (text.indexOf("元") > 0) {//满减红包
                        var texts = text.split("元");
                        for (var j = 0; j < texts.length; j++) {
                            ctx.font = j == 0 ? 'bold 20px 微软雅黑' : '14px 微软雅黑';
                            if (j == 0) {
                                ctx.fillText(texts[j] + "元", -ctx.measureText(texts[j] + "元").width / 2, j * line_height);
                            } else {
                                ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
                            }
                        }
                    } else if (text.length > 6) {//奖品名称长度超过一定范围
                        text = text.substring(0, 6) + "||" + text.substring(6);
                        var texts = text.split("||");
                        for (var j = 0; j < texts.length; j++) {
                            ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
                        }
                    } else {
                        //在画布上绘制填色的文本。文本的默认颜色是黑色
                        //measureText()方法返回包含一个对象，该对象包含以像素计的指定字体宽度
                        ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
                    }

                    //把当前画布返回（调整）到上一个save()状态之前
                    ctx.restore();
                    //----绘制奖品结束----
                }
            }
        }
    })
</script>

</body>
</html>